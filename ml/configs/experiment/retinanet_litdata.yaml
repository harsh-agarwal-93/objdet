# RetinaNet + LitData Full Experiment Configuration
# Usage: objdet fit --config configs/experiment/retinanet_litdata.yaml

# Model Configuration
model:
  class_path: objdet.models.torchvision.RetinaNet
  init_args:
    num_classes: 80
    backbone: resnet50_fpn_v2
    pretrained: false
    pretrained_backbone: true
    trainable_backbone_layers: 3
    min_size: 800
    max_size: 1333
    score_thresh: 0.05
    nms_thresh: 0.5
    detections_per_img: 300
    learning_rate: 0.001
    weight_decay: 0.0001
    optimizer: adamw
    scheduler: cosine
    scheduler_kwargs:
      T_max: 100
      eta_min: 0.000001

# Data Configuration - LitData optimized format
data:
  class_path: objdet.data.formats.litdata.LitDataDataModule
  init_args:
    data_dir: /path/to/litdata # Update with your LitData dataset path
    train_subdir: train
    val_subdir: val
    test_subdir: test
    batch_size: 8
    num_workers: 4
    pin_memory: true
    persistent_workers: true

# Trainer Configuration
trainer:
  max_epochs: 100
  accelerator: auto
  devices: auto
  precision: 16-mixed
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1
  log_every_n_steps: 50
  check_val_every_n_epoch: 1
  callbacks:
    - class_path: lightning.pytorch.callbacks.ModelCheckpoint
      init_args:
        monitor: val/mAP
        mode: max
        save_top_k: 3
        save_last: true
        filename: "epoch={epoch:02d}-mAP={val/mAP:.4f}"
    - class_path: lightning.pytorch.callbacks.EarlyStopping
      init_args:
        monitor: val/mAP
        mode: max
        patience: 10
    - class_path: lightning.pytorch.callbacks.LearningRateMonitor
      init_args:
        logging_interval: step
  logger:
    class_path: lightning.pytorch.loggers.TensorBoardLogger
    init_args:
      save_dir: logs
      name: retinanet_litdata
