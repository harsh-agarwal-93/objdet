# GitLab CI/CD Pipeline for ObjDet
# https://docs.gitlab.com/ee/ci/yaml/

stages:
  - lint
  - test
  - build
  - docs
  - release

variables:
  UV_CACHE_DIR: .uv-cache
  PIP_CACHE_DIR: .pip-cache
  PYTHON_VERSION: "3.12"

# Cache configuration
.uv-cache: &uv-cache
  cache:
    key:
      files:
        - uv.lock
    paths:
      - .uv-cache
      - .venv
    policy: pull-push

# Base job template
.base-job:
  image: python:${PYTHON_VERSION}-slim
  before_script:
    - pip install uv
    - uv sync --frozen
  <<: *uv-cache

# =============================================================================
# Lint Stage
# =============================================================================
include:
  - local: ".gitlab/ci/lint.yml"
  - local: ".gitlab/ci/test.yml"
  - local: ".gitlab/ci/docs.yml"
  - local: ".gitlab/ci/release.yml"
